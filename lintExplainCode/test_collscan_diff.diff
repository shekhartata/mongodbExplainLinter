diff --git a/src/user_service.py b/src/user_service.py
index a1b2c3d..e4f5g6h 100644
--- a/src/user_service.py
+++ b/src/user_service.py
@@ -15,7 +15,7 @@ def get_all_users():
-    return db.users.find({})
+    return db.users.find({}, {'password': 0, 'email': 0})
@@ -25,8 +25,8 @@ def search_users_by_name():
-    return db.users.find({'first_name': name})
+    return db.users.find({'first_name': {'$regex': name, '$options': 'i'}})
@@ -35,5 +35,5 @@ def get_users_by_age_range():
-    return db.users.find({'age': {'$gte': min_age, '$lte': max_age}})
+    return db.users.find({'age': {'$gte': min_age, '$lte': max_age}, 'status': 'active'})
@@ -45,7 +45,7 @@ def get_users_by_location():
-    return db.users.find({'city': city, 'country': country})
+    return db.users.find({'city': city, 'country': country, 'status': 'active', 'verified': True})
@@ -55,8 +55,8 @@ def get_users_by_join_date():
-    return db.users.find({'created_at': {'$gte': start_date}})
+    return db.users.find({'created_at': {'$gte': start_date}, 'status': 'active', 'role': 'user'})
@@ -65,5 +65,5 @@ def get_users_by_preferences():
-    return db.users.find({'preferences.category': category})
+    return db.users.find({'preferences.category': category, 'preferences.active': True, 'status': 'active'})

diff --git a/src/user_analytics.py b/src/user_analytics.py
index h7i8j9k..l0m1n2o 100644
--- a/src/user_analytics.py
+++ b/src/user_analytics.py
@@ -20,8 +20,8 @@ def get_user_statistics():
-    return db.users.aggregate([
-        {'$match': {'status': 'active'}},
-        {'$group': {'_id': '$role', 'count': {'$sum': 1}}}
-    ])
+    return db.users.aggregate([
+        {'$match': {'status': 'active', 'verified': True, 'last_login': {'$gte': '2024-01-01'}}},
+        {'$group': {'_id': '$role', 'count': {'$sum': 1}}},
+        {'$sort': {'count': -1}}
+    ])
@@ -30,8 +30,8 @@ def get_user_activity():
-    return db.users.aggregate([
-        {'$match': {'last_login': {'$gte': start_date}}},
-        {'$group': {'_id': '$city', 'active_users': {'$sum': 1}}}
-    ])
+    return db.users.aggregate([
+        {'$match': {'last_login': {'$gte': start_date}, 'status': 'active', 'verified': True}},
+        {'$group': {'_id': '$city', 'active_users': {'$sum': 1}}},
+        {'$sort': {'active_users': -1}}
+    ])
@@ -40,5 +40,5 @@ def get_user_demographics():
-    return db.users.find({'age': {'$gte': 18}})
+    return db.users.find({'age': {'$gte': 18}, 'status': 'active', 'verified': True, 'country': 'US'})

diff --git a/src/user_search.py b/src/user_search.py
index p3q4r5s..t6u7v8w 100644
--- a/src/user_search.py
+++ b/src/user_search.py
@@ -15,7 +15,7 @@ def search_users_by_email():
-    return db.users.find({'email': email})
+    return db.users.find({'email': {'$regex': email, '$options': 'i'}, 'status': 'active'})
@@ -25,8 +25,8 @@ def search_users_by_phone():
-    return db.users.find({'phone': phone})
+    return db.users.find({'phone': {'$regex': phone}, 'status': 'active', 'verified': True})
@@ -35,5 +35,5 @@ def search_users_by_address():
-    return db.users.find({'address.street': street})
+    return db.users.find({'address.street': {'$regex': street, '$options': 'i'}, 'status': 'active'})
@@ -45,7 +45,7 @@ def search_users_by_company():
-    return db.users.find({'company.name': company_name})
+    return db.users.find({'company.name': {'$regex': company_name, '$options': 'i'}, 'status': 'active', 'verified': True})

diff --git a/src/user_management.py b/src/user_management.py
index x9y0z1a..b2c3d4e 100644
--- a/src/user_management.py
+++ b/src/user_management.py
@@ -10,8 +10,8 @@ def get_inactive_users():
-    return db.users.find({'status': 'inactive'})
+    return db.users.find({'status': 'inactive', 'last_login': {'$lt': '2024-01-01'}})
@@ -20,8 +20,8 @@ def get_users_needing_verification():
-    return db.users.find({'verified': False})
+    return db.users.find({'verified': False, 'status': 'active', 'created_at': {'$gte': '2024-01-01'}})
@@ -30,8 +30,8 @@ def get_users_by_subscription():
-    return db.users.find({'subscription.status': 'active'})
+    return db.users.find({'subscription.status': 'active', 'subscription.plan': 'premium', 'status': 'active'})
@@ -40,7 +40,7 @@ def get_users_by_permissions():
-    return db.users.find({'permissions.admin': True})
+    return db.users.find({'permissions.admin': True, 'status': 'active', 'verified': True, 'last_login': {'$gte': '2024-01-01'}})

diff --git a/src/user_reports.py b/src/user_reports.py
index f5g6h7i..j8k9l0m 100644
--- a/src/user_reports.py
+++ b/src/user_reports.py
@@ -15,7 +15,7 @@ def generate_user_report():
-    return db.users.find({})
+    return db.users.find({}, {'password': 0, 'email': 0, 'phone': 0})
@@ -25,8 +25,8 @@ def generate_user_export():
-    return db.users.find({'status': 'active'})
+    return db.users.find({'status': 'active', 'verified': True, 'last_login': {'$gte': '2024-01-01'}})
@@ -35,5 +35,5 @@ def generate_user_summary():
-    return db.users.aggregate([
-        {'$count': 'total_users'}
-    ])
+    return db.users.aggregate([
+        {'$match': {'status': 'active'}},
+        {'$count': 'total_users'}
+    ])
@@ -45,7 +45,7 @@ def generate_user_metrics():
-    return db.users.find({'created_at': {'$gte': start_date}})
+    return db.users.find({'created_at': {'$gte': start_date}, 'status': 'active', 'verified': True, 'role': 'user'})
